
<!DOCTYPE html>
<html>
  <head>
  <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase-auth.js"></script>

<script src="https://www.gstatic.com/firebasejs/5.5.4/firebase.js"></script>
<link type="text/scss" rel="stylesheet" src="/app/assets/stylesheets/firebase.scss" />

<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyClJJOAuvm2zqVA_SfqfCM5wfwDZmbEWH0",
    authDomain: "teamapp-project-debc5.firebaseapp.com",
    databaseURL: "https://teamapp-project-debc5.firebaseio.com",
    projectId: "teamapp-project-debc5",
    storageBucket: "teamapp-project-debc5.appspot.com",
    messagingSenderId: "255431340262"
  };
  firebase.initializeApp(config);
</script>

<script src="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.js"></script>
<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.4.1/firebaseui.css" />
    <script type="text/javascript">
      // FirebaseUI config.
      var uiConfig = {
  callbacks: {
    signInSuccessWithAuthResult: function(authResult, redirectUrl) {
      // User successfully signed in.
      // Return type determines whether we continue the redirect automatically
      // or whether we leave that to developer to handle.
      return true;
    },
    uiShown: function() {
      // The widget is rendered.
      // Hide the loader.
      document.getElementById('loader').style.display = 'none';
    }
  },
  // Will use popup for IDP Providers sign-in flow instead of the default, redirect
  signInSuccessUrl: '/articles',
  signInOptions: [
    // Leave the lines as is for the providers you want to offer your users.
    firebase.auth.GoogleAuthProvider.PROVIDER_ID,
    firebase.auth.FacebookAuthProvider.PROVIDER_ID,
    firebase.auth.TwitterAuthProvider.PROVIDER_ID
  ],
  // Terms of service url.
  tosUrl: 'https://www.google.com',
  // Privacy policy url.
  privacyPolicyUrl: 'https://www.google.com'
};

      // Initialize the FirebaseUI Widget using Firebase.
      var ui = new firebaseui.auth.AuthUI(firebase.auth());
      // The start method will wait until the DOM is loaded.
      ui.disableAutoSignIn();
      ui.start('#firebaseui-auth-container', uiConfig);
    </script>

     <script type="text/javascript">
      initApp = function() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
            var displayName = user.displayName;
            var email = user.email;
            var emailVerified = user.emailVerified;
            var photoURL = user.photoURL;
            var uid = user.uid;
            var phoneNumber = user.phoneNumber;
            var providerData = user.providerData;
            user.getIdToken().then(function(accessToken) {
              
              document.getElementById('sign-in-status').textContent = 'Signed in as: ' + `${user.displayName}`;
              document.getElementById('sign-in').textContent = 'Sign out'
              document.getElementById('sign-in').addEventListener('click', function() {
              firebase.auth().signOut().then(function() {
                   var provider = new firebase.auth.GoogleAuthProvider();
        alert('You have Signed Out. Please Sign In');
      }).catch(function(error) {
        // An error happened.
        alert('An error happened');
      });
                // Sign-out successful.
               })
              if (user.photoURL) {
              var photoURL = user.photoURL;
              if (
              photoURL.indexOf('googleusercontent.com') != -1 ||
              photoURL.indexOf('ggpht.com') != -1
              ) {
              photoURL =
              photoURL + '?sz=' + document.getElementById('photo').clientHeight;
              }
              document.getElementById('photo').src = photoURL;
              document.getElementById('photo').style.display = 'block';
              document.getElementById('loading').style.display = 'none';
              } else {
              document.getElementById('photo').style.display = 'none';
              }
            })
          } else {
            // User is signed out.
            document.getElementById('sign-in-status').textContent = 'Signed out';
            document.getElementById('sign-in').style.display = 'none';
            document.getElementById('photo').style.display = 'none';
          }
        }, function(error) {
          console.log(error);
        });
      };

      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.SESSION)

      window.addEventListener('load', function() {
        initApp()
      });
    </script>

    <title>Team Creator</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>

    
  </head>

  <body>
    <div id="sign-in-status"></div>
     <img id="photo"></img>
    <button id="sign-in"></button>
    <div class="container">
      <%= yield %>
    </div>
    
  </body>
</html>
